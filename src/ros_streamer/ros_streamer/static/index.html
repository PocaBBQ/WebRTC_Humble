<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <title>WebRTC: C920e Direct Stream</title>
  <style>body{font-family:system-ui;margin:2rem} video{width:100%;max-width:960px;border-radius:12px}</style>
</head>
<body>
  <h2>Live Stream</h2>
  <video id="v" autoplay playsinline controls muted></video>
  <p id="status">Idle…</p>
  <script>
    async function start() {
        // No STUN/TURN: LAN-only
        const pc = new RTCPeerConnection({ iceServers: [] });

        const video = document.getElementById('v');
        const status = document.getElementById('status');

        pc.ontrack = (ev) => {
        video.srcObject = ev.streams[0];
        status.textContent = 'Streaming…';
        };

        const offer = await pc.createOffer({ offerToReceiveVideo: true });
        await pc.setLocalDescription(offer);

        const resp = await fetch('/offer', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ sdp: pc.localDescription.sdp, type: pc.localDescription.type })
        });
        if (!resp.ok) {
        status.textContent = 'Offer failed: ' + resp.status + ' ' + resp.statusText;
        return;
        }
        const answer = await resp.json();
        await pc.setRemoteDescription(answer);
    }
    start().catch(e => document.getElementById('status').textContent = 'Error: ' + e);
</script>

</body>
</html>
